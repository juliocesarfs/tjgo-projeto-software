@startuml C4_Container_ControlTasks

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

' ============================================================================
' CONTAINER DIAGRAM - Level 2
' Control Tasks Backend - Arquitetura de Containers
' ============================================================================

LAYOUT_WITH_LEGEND()

Person(userPerson, "User", "Usuário do sistema")
Person(adminPerson, "Admin", "Administrador do sistema")

System_Boundary(controlTasksSystem, "Control Tasks System") {
    ' ============================================================================
    ' CONTAINER: WEB APPLICATION
    ' ============================================================================
    Container(webApp, "Web Application", "React / TypeScript", "Interface web responsiva para:\n- Gerenciamento de tarefas\n- Colaboração em equipe\n- Visualização de estatísticas\n- Notificações em tempo real")

    ' ============================================================================
    ' CONTAINER: MOBILE APPLICATION
    ' ============================================================================
    Container(mobileApp, "Mobile Application", "React Native", "Aplicativo mobile para:\n- Acesso offline limitado\n- Sincronização com nuvem\n- Notificações push\n- Interface adaptada a dispositivos móveis")

    ' ============================================================================
    ' CONTAINER: API REST
    ' ============================================================================
    Container(apiRest, "API REST", "NestJS 11 / TypeScript", "Aplicação backend responsável por:\n- Endpoints HTTP (Controllers)\n- Lógica de negócio (Use Cases)\n- Modelos de domínio (Entities)\n- Validação de entrada (DTOs)\n- Autenticação e autorização")

    ' ============================================================================
    ' CONTAINER: DATABASE
    ' ============================================================================
    Container(postgresDB, "Database", "PostgreSQL 12+", "Armazena:\n- Usuários (User)\n- Notas/Tarefas (Note)\n- Times (Team)\n- Relacionamentos entre entidades")

}

System_Ext(emailService, "Email Service", "SendGrid/AWS SES", "Notificações via email")

' ============================================================================
' RELACIONAMENTOS EXTERNO
' ============================================================================

Rel(userPerson, webApp, "Acessa via navegador", "HTTPS")
Rel(userPerson, mobileApp, "Acessa via app", "HTTPS")
Rel(adminPerson, webApp, "Gerencia via navegador", "HTTPS")
Rel(adminPerson, mobileApp, "Gerencia via app", "HTTPS")

Rel(webApp, apiRest, "Faz requisições API", "HTTP/REST\nJSON\nBearer Token (JWT)")
Rel(mobileApp, apiRest, "Faz requisições API", "HTTP/REST\nJSON\nBearer Token (JWT)")

' ============================================================================
' RELACIONAMENTOS INTERNOS
' ============================================================================

Rel(apiRest, postgresDB, "Lê/Escreve dados", "SQL via Prisma ORM\nConnection Pool")
Rel(postgresDB, apiRest, "Retorna dados", "Queries result")

Rel(apiRest, emailService, "Envia notificações", "SMTP/API")

' ============================================================================
' NOTAS
' ============================================================================

note right of webApp
  **Funcionalidades:**
  - Dashboard de tarefas
  - Formulários de criação/edição
  - Visualização de times
  - Notificações web
  - Responsivo para desktop/mobile
end note

note right of mobileApp
  **Funcionalidades:**
  - Interface nativa mobile
  - Sincronização offline
  - Push notifications
  - Gestos touch
  - Otimizado para iOS/Android
end note

note right of apiRest
  **Responsabilidades:**
  - Autenticação e Autorização
  - CRUD de Notas
  - CRUD de Usuários
  - Gerenciamento de Times
  - Filtros e Estatísticas
  - Validação de permissões

  **Padrões:**
  - Clean Architecture
  - Repository Pattern
  - Use Case Pattern
  - Dependency Injection
end note

note right of postgresDB
  **Tabelas principais:**
  - User (email, name, password, type)
  - Note (title, status, priority, dueDate)
  - Team (name, code, adminId)

  **Índices em:**
  - email, teamId
  - createdById, assignedToId
  - status, category
end note

@enduml
